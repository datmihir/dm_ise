<div class="main-container">
  
  <!-- Header -->
  <header>
    <h1>Data Mining</h1>
    <p>ISE 1</p>
    <button mat-icon-button (click)="toggleTheme()" class="theme-toggle" [attr.aria-label]="'Toggle ' + (isDarkMode() ? 'light' : 'dark') + ' mode'">
      <mat-icon>{{ isDarkMode() ? 'dark_mode' : 'light_mode' }}</mat-icon>
    </button>
  </header>
  
  <div class="content-grid">
    <!-- Left Column -->
    <div class="left-column">
      <section class="card">
        <h2><mat-icon>folder_open</mat-icon> Dataset Library</h2>
        <mat-list role="list" *ngIf="datasets().length > 0; else noDatasets">
          <mat-list-item
            *ngFor="let ds of datasets()"
            (click)="selectDataset(ds)"
            [class.selected]="selectedDataset()?.id === ds.id"
            role="listitem">
            <mat-icon matListItemIcon>description</mat-icon>
            <div matListItemTitle class="list-item-title">{{ ds.filename }}</div>
            <div matListItemLine class="list-item-line">Uploaded: {{ ds.upload_date }}</div>
            <div matListItemLine class="list-item-line columns-line">Columns: {{ ds.columns.join(', ') }}</div>
            
            <!-- Add this delete button -->
            <button mat-icon-button (click)="deleteDataset($event, ds.id)" class="delete-btn" matListItemMeta>
                <mat-icon>delete_outline</mat-icon>
            </button>
          </mat-list-item>
        </mat-list>
        <ng-template #noDatasets>
            <p class="placeholder-text">No datasets uploaded yet. Click "Upload New" to get started.</p>
        </ng-template>
      </section>
    </div>

    <!-- Right Column -->
    <div class="right-column">
       <section class="card upload-card">
         <h2><mat-icon>upload_file</mat-icon> Upload Dataset</h2>
         <button mat-flat-button color="primary" (click)="openUploadDialog()">
           <mat-icon>add</mat-icon>
           Upload New Dataset
         </button>
       </section>
      
       <section class="card" *ngIf="selectedDataset()">
        <h2>
          <mat-icon>settings_suggest</mat-icon> 
          <span class="actions-title">Actions for: {{ selectedDataset()?.filename }}</span>
        </h2>
         <div class="actions-container">
           <button mat-raised-button color="primary" (click)="openPreprocess()">
             <mat-icon>tune</mat-icon>
             Pre-process Data
           </button>
           <button mat-raised-button color="accent" (click)="openClassify()">
             <mat-icon>model_training</mat-icon>
             Classification
           </button>
           <button mat-stroked-button (click)="openHistory()">
             <mat-icon>history</mat-icon>
             View History
           </button>
         </div>
       </section>
    </div>
  </div>
  
  <!-- Full-width Preview Section -->
  <section class="card preview" *ngIf="selectedDataset()">
    <h2>
      <mat-icon>table_chart</mat-icon>
      <span>Preview: {{ selectedDataset()?.filename }}</span>
    </h2>
    <mat-progress-bar *ngIf="uploading()" mode="indeterminate"></mat-progress-bar>
    <div class="preview-container" *ngIf="!uploading() && previewCols().length > 0">
      <table mat-table [dataSource]="previewRows()" class="mat-elevation-z2">
        <ng-container *ngFor="let col of previewCols()" [matColumnDef]="col">
          <th mat-header-cell *matHeaderCellDef>{{ col }}</th>
          <td mat-cell *matCellDef="let row">{{ row[col] }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="previewCols()"></tr>
        <tr mat-row *matRowDef="let row; columns: previewCols();"></tr>
      </table>
    </div>
    <p *ngIf="!uploading() && previewCols().length === 0" class="placeholder-text">
      No preview available.
    </p>
  </section>
</div>
